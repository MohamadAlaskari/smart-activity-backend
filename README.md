# üöÄ VibeDay ‚Äì Backend

![TypeScript](https://img.shields.io/badge/TypeScript-5.7-blue?logo=typescript)
![NestJS](https://img.shields.io/badge/NestJS-10.x-red?logo=nestjs)
![MySQL](https://img.shields.io/badge/Database-MySQL-informational?logo=mysql)
![Mailer](https://img.shields.io/badge/SMTP-Hostinger-purple)
![Swagger](https://img.shields.io/badge/Docs-Swagger-blueviolet)
![OpenAI](https://img.shields.io/badge/AI-GPT--4-ff69b4?logo=openai)
![Ticketmaster](https://img.shields.io/badge/Events-Ticketmaster-black?logo=ticketmaster)
![Weather](https://img.shields.io/badge/Weather-VisualCrossing-00BFFF)
![Maps](https://img.shields.io/badge/Maps-Google--Directions-blue?logo=googlemaps)
![Auth](https://img.shields.io/badge/Auth-JWT%20%7C%20bcrypt-orange)
![ORM](https://img.shields.io/badge/ORM-TypeORM-darkred?logo=typeorm)
![Frontend](https://img.shields.io/badge/Frontend-Flutter-02569B?logo=flutter)
![Deploy](https://img.shields.io/badge/Deploy-Vercel-black?logo=vercel)
![Status](https://img.shields.io/badge/status-active-brightgreen)
![License](https://img.shields.io/badge/License-Private-lightgrey)


---


This is the backend of **VibeDay**, an intelligent activity recommendation platform powered by real-time data and AI. Built with NestJS, it integrates weather, events, health metrics, and user preferences to deliver smart suggestions.

---

## üîó Live Backend URL

```
https://smart-activity-backend.alaskaritech.com
```
---


## üì¶ Features

- üîê **Authentication System**  
  Secure JWT-based authentication with:
  - User registration & login
  - Email verification
  - Password reset via tokenized email links

- üë§ **User Management**  
  Full CRUD operations for user accounts

- ‚öôÔ∏è **Preferences Module**  
  Store and manage individual preferences including:
  - Budget
  - Group size
  - Time availability windows
  - Distance radius

- ‚òÅÔ∏è **Weather Integration**  
  - 7-day weather forecast
  - Daily and hourly breakdown by coordinates  
  _(Powered by VisualCrossing API)_

- üé´ **Event Integration**  
  - Filter events by location, date, radius, and group size
  - Connected to the Ticketmaster API

- ‚ù§Ô∏è **Health Awareness**  
  - Analyze blood pressure, sleep, stress, and activity
  - Enhance suggestions based on personal health context

- ü§ñ **AI-Powered Suggestions**  
  - Uses OpenAI GPT for generating personalized recommendations  
  - Context includes: preferences, weather, health, and events  
  - Returns structured JSON with human-readable logic explanations

- ‚úâÔ∏è **Email Notifications**  
  - Welcome, email verification, and password reset emails  
  - HTML templates using Hostinger SMTP via Nodemailer

- üåç **Geolocation & Directions**  
  - Resolve city from coordinates  
  - Estimate travel time and distance (walking, driving, etc.)  
  _(Using Google Directions API + Mapbox support)_

- üß™ **API Documentation**  
  - Swagger-based OpenAPI documentation  
  - Developer-friendly interactive testing interface

---
## üîê Authentication & Security

Security and user identity verification are critical in **VibeDay's** backend architecture. The authentication system is designed with **robustness**, **extensibility**, and **developer-friendliness** in mind.

---

### üõ†Ô∏è Key Mechanisms

- **JWT Authentication**  
  All protected endpoints require a valid JSON Web Token (JWT), issued during login and verified by a global `AuthGuard`.

- **Password Hashing**  
  User passwords are securely hashed using **bcrypt** before being stored in the MySQL database.

- **Email Verification**  
  After registration, users must verify their email through a tokenized link sent via **SMTP**.

- **Password Reset Flow**
  1. User requests reset: `POST /auth/request-reset`
  2. Tokenized link is sent via email
  3. HTML reset form is served at: `GET /auth/reset-password`
  4. New password is submitted via `POST /auth/reset-password`

- **Access Control**  
  Routes like preferences, health data, and suggestions are protected with `@UseGuards(AuthGuard)`.

- **Token Storage**  
  JWTs are stored client-side (e.g., secure storage on mobile) and included in request headers.

---

### üîí Security Best Practices

- ‚úÖ **HTTPS enforced** in deployment using Vercel + custom domain SSL
- ‚úÖ **DTO-based validation** using `class-validator` for all incoming payloads
- ‚úÖ **Global Exception Filters** for safe, consistent error handling
- ‚úÖ **Public vs. Protected Route Separation** to minimize attack surface



---
## üìò API Endpoints Overview

The API is fully documented using **Swagger (OpenAPI)** and accessible via `/api` in development.  
Below is a summary of the key endpoints grouped by module:

---

### üîê Authentication

- `POST /auth/register` ‚Äì Register new users  
- `POST /auth/login` ‚Äì Login with email and password  
- `GET  /auth/verify-email` ‚Äì Verify account via token  
- `GET  /auth/current-user` ‚Äì Get currently logged-in user (requires token)  
- `POST /auth/request-reset` ‚Äì Request password reset via email  
- `GET  /auth/reset-password` ‚Äì Serve reset form (HTML template)  
- `POST /auth/reset-password` ‚Äì Submit new password using token  

---

### üë§ Users

- `POST /users` ‚Äì Create new user  
- `GET /users` ‚Äì Fetch user info (requires token)  
- `PATCH /users` ‚Äì Update user details  
- `DELETE /users` ‚Äì Delete user account  

---

### ‚öôÔ∏è User Preferences

- `POST /user-preferences` ‚Äì Create preferences  
- `GET /user-preferences` ‚Äì Fetch preferences  
- `PATCH /user-preferences` ‚Äì Update preferences  

---

### ‚ù§Ô∏è Health Data

- `POST /health-data` ‚Äì Submit health metrics (e.g. blood pressure, sleep, activity)  
- `GET  /health-data` ‚Äì Get health data of the current user  

---

### ‚òÄÔ∏è Weather

- `GET /weather/week/location` ‚Äì 7-day forecast via city  
- `GET /weather/week/coordinates` ‚Äì 7-day forecast via coordinates  
- `GET /weather/week/hours/coordinates` ‚Äì Hourly forecast for the next 7 days  
- `GET /weather/day/coordinates` ‚Äì Daily forecast by coordinates  
- `GET /weather/forecast/date` ‚Äì Forecast for a specific date  

---

### üé´ Events

- `GET /events` ‚Äì Load events from Ticketmaster API  
  **Query Params:** `lat`, `lon`, `date`, `radius`, `size`

---

### üöó Directions

- `GET /directions/duration` ‚Äì Get duration and distance between two locations  
  **Modes:** driving, walking, bicycling, transit  

- `GET /directions/resolve-city` ‚Äì Resolve city name from coordinates  

---

### ü§ñ Suggestions

- `GET /suggestions` ‚Äì Generate AI-based activity suggestions  

  **Query Parameters:**
  - `lat`: Latitude (e.g., `52.52`)
  - `lon`: Longitude (e.g., `13.405`)
  - `date`: Desired date in format `YYYY-MM-DD` (e.g., `2025-06-25`)

  > This endpoint compiles a full context based on user preferences, health data, weather, events, and geolocation to return structured, AI-powered suggestions tailored to user well-being and current conditions.

---

### üîê Security Note

All sensitive endpoints are protected using **JWT-based AuthGuard**.  
Interactive testing and full documentation are available via **Swagger UI** (`/api`).

---


## üßë‚Äçüíª Tech Stack

| Component          | Technology / Service          |
|--------------------|-------------------------------|
| **Language**       | TypeScript                    |
| **Backend**        | NestJS                        |
| **Frontend Client**| Flutter                       |
| **Database**       | MySQL (via Hostinger)         |
| **ORM**            | TypeORM                       |
| **Authentication** | JWT + bcrypt                  |
| **Mailing**        | Nodemailer + Hostinger SMTP   |
| **API Docs**       | Swagger / OpenAPI             |
| **Weather Data**   | VisualCrossing API            |
| **Event Search**   | Ticketmaster API              |
| **Location**       | Google Directions API, Mapbox |
| **AI Engine**      | OpenAI GPT-4                  |
| **Deployment**     | Vercel (CI/CD) + Hostinger DNS|

---

## üõ†Ô∏è Installation

### Klone das Projekt
```bash
git clone https://github.com/dein-nutzer/smart-activity-backend.git
cd smart-activity-backend
```
### Project setup

```bash
$ npm install
```
### Compile and run the project

```bash
# development
$ npm run start

# watch mode
$ npm run start:dev

# production mode
$ npm run start:prod
```


---
### üìÅ .env Datei (Beispiel)

```
PORT=3000
```



#### DB  
```
DB_PORT=3306
DB_HOST=srv972.hstgr.io
DB_USERNAME=u252525807_SamrtAdmin
DB_PASSWORD=SamrtActivity+SamrtAdmin2025.
DB_DATABASE=u252525807_SamrtActivity
```

#### JWT
```
JWT_SECRET=
JWT_EXPIRES_IN=
```


#### SMTP (Simple Mail Transfer Protocol)
```
SMTP_HOST=
SMTP_PORT=
SMTP_USER=
SMTP_PASS=
SMTP_FROM_NAME=
```

#### OpenAI API key for development environment
```
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4.1-mini
```

#### OpenWeather API key for development environment
```
VISUAL_CROSSING_API_KEY=
```

#### Ticketmaster API key for development environment
```
TICKETMASTER_API_KEY=
```

#### Eventbrite API key for development environment
```
EVENTBRITE_API_KEY=
```

#### Directions API key for development environment
```
GOOGLE_MAPS_API_KEY=
```

#### Mapbox API key for development environment
```
MAPBOX_ACCESS_TOKEN=
```

---

## üß™ API Endpoints Overview
The API is fully documented using Swagger (OpenAPI). Below is a summarized list of the most important endpoints organized by module:

### üì• `POST /auth/register`
Registriert neuen Nutzer und sendet Verifizierungslink per Mail.  
**Body:**
```json
{
  "firstName": "John",
  "lastName": "Doe",
  "username": "johnny",
  "email": "john@example.com",
  "password": "123456"
}
```

### ‚úÖ `GET /auth/verify-email?token=...`
Verifiziert den User anhand des Tokens. G√ºltig f√ºr 30 Minuten.

### üîê `POST /auth/login`
Gibt ein g√ºltiges Access Token bei erfolgreichem Login zur√ºck.

```
{
  "email": "john@example.com",
  "password": "123456"
}
```

---

## üìò Swagger

Alle Endpunkte sind dokumentiert unter:

```
http://localhost:3000/swagger
```

---

## üìÅ Projektstruktur (Module-basiert)

```
üì¶src
 ‚î£ üìÇcommon
 ‚îÉ ‚î£ üìÇdecorators
 ‚îÉ ‚îÉ ‚îó üìúcurrent-user.decorator.ts
 ‚îÉ ‚î£ üìÇfilters
 ‚îÉ ‚îÉ ‚îó üìúglobal-exception.filter.ts
 ‚îÉ ‚î£ üìÇguards
 ‚îÉ ‚îÉ ‚îó üìúauth.guard.ts
 ‚îÉ ‚î£ üìÇutils
 ‚îÉ ‚îÉ ‚î£ üìÇconstants
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúai.constant.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúdirections.constants.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúevents.constants.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúuser.constants.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúweather.constants.ts
 ‚îÉ ‚îÉ ‚îó üìÇtypes
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìútypes.ts
 ‚îÉ ‚îó üìúapp-config.service.ts
 ‚î£ üìÇconfig
 ‚îÉ ‚îó üìúswagger.config.ts
 ‚î£ üìÇcore
 ‚îÉ ‚îó üìÇai
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúprompt.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìústructured-suggestions.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúsuggestion-result.dto.ts
 ‚îÉ ‚îÉ ‚î£ üìúai.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúai.module.ts
 ‚îÉ ‚îÉ ‚îó üìúai.service.ts
 ‚î£ üìÇdatabase
 ‚îÉ ‚î£ üìÇconfig
 ‚îÉ ‚îÉ ‚îó üìúdb.config.ts
 ‚îÉ ‚îó üìúdatabase.module.ts
 ‚î£ üìÇmodules
 ‚îÉ ‚î£ üìÇauth
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúlogin.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúregister.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúrequest-password-reset.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúreset-password.dto.ts
 ‚îÉ ‚îÉ ‚î£ üìÇtemplates
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúreset-error.template.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúreset-password-form.template.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúreset-success.template.ts
 ‚îÉ ‚îÉ ‚î£ üìúauth.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúauth.module.ts
 ‚îÉ ‚îÉ ‚îó üìúauth.service.ts
 ‚îÉ ‚î£ üìÇdirections
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúget-city-by-coords.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúget-directions.dto.ts
 ‚îÉ ‚îÉ ‚î£ üìÇenums
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúdirections-mode.enum.ts
 ‚îÉ ‚îÉ ‚î£ üìÇinterfaces
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúdirections-response.interface.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúmapbox-geocode-response.interface.ts
 ‚îÉ ‚îÉ ‚î£ üìúdirections.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúdirections.module.ts
 ‚îÉ ‚îÉ ‚îó üìúdirections.service.ts
 ‚îÉ ‚î£ üìÇevents
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúget-events-flat.dto.ts
 ‚îÉ ‚îÉ ‚î£ üìúevents.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúevents.module.ts
 ‚îÉ ‚îÉ ‚îó üìúevents.service.ts
 ‚îÉ ‚î£ üìÇhealth-data
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúblood-pressure.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúcreate-health-data.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúupdate-health-data.dto.ts
 ‚îÉ ‚îÉ ‚î£ üìÇentities
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúblood-pressure.embedded.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúhealth-data.entity.ts
 ‚îÉ ‚îÉ ‚î£ üìúhealth-data.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúhealth-data.module.ts
 ‚îÉ ‚îÉ ‚îó üìúhealth-data.service.ts
 ‚îÉ ‚î£ üìÇmail
 ‚îÉ ‚îÉ ‚î£ üìÇtemplates
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúupdatePasswordEmail.template.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúverification.template.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúwelcome.template.ts
 ‚îÉ ‚îÉ ‚î£ üìÇtypes
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúmailOptions.type.ts
 ‚îÉ ‚îÉ ‚î£ üìúmail.module.ts
 ‚îÉ ‚îÉ ‚îó üìúmail.service.ts
 ‚îÉ ‚î£ üìÇsuggestion
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúcreate-suggestion.dto.ts
 ‚îÉ ‚îÉ ‚î£ üìÇentities
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúsuggestion.entity.ts
 ‚îÉ ‚îÉ ‚î£ üìÇutils
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúsuggestion.constant.ts
 ‚îÉ ‚îÉ ‚î£ üìúsuggestions.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúsuggestions.module.ts
 ‚îÉ ‚îÉ ‚îó üìúsuggestions.service.ts
 ‚îÉ ‚î£ üìÇuser-preferences
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúcreate-user-preferences.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúupdate-user-preferences.dto.ts
 ‚îÉ ‚îÉ ‚î£ üìÇentities
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúuser-preferences.entity.ts
 ‚îÉ ‚îÉ ‚î£ üìúuser-preferences.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúuser-preferences.module.ts
 ‚îÉ ‚îÉ ‚îó üìúuser-preferences.service.ts
 ‚îÉ ‚î£ üìÇusers
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúcreate-user.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúupdate-user.dto.ts
 ‚îÉ ‚îÉ ‚î£ üìÇentities
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúuser.entity.ts
 ‚îÉ ‚îÉ ‚î£ üìúusers.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúusers.module.ts
 ‚îÉ ‚îÉ ‚îó üìúusers.service.ts
 ‚îÉ ‚îó üìÇweather
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúget-week-weather.dto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúGetDayWeatherByCoordsDto.ts
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúgetForecastByDate.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúGetWeekWeatherByCoordsDto.ts
 ‚îÉ ‚îÉ ‚î£ üìÇinterfaces
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìúDailyForecast.ts
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìúweather-week-forecast.interface.ts
 ‚îÉ ‚îÉ ‚î£ üìúweather.controller.ts
 ‚îÉ ‚îÉ ‚î£ üìúweather.module.ts
 ‚îÉ ‚îÉ ‚îó üìúweather.service.ts
 ‚î£ üìú.editorconfig
 ‚î£ üìúapp.controller.ts
 ‚î£ üìúapp.module.ts
 ‚îó üìúmain.ts
```
---





## ‚úÖ Status

- [x] Registrierung + E-Mail-Verifizierung
- [x] Login + JWT
- [x] User CRUD
- [x] Deployment + Swagger
- [x] MailService

---

## üë®‚Äçüíª Autor

> **Mohamad Alaskari**  
> üì´ [mohamad@alaskaritech.com](mailto:mohamad@alaskaritech.com)  
> üåê [www.alaskaritech.com](https://www.alaskaritech.com)  
> üßë‚Äçüíª GitHub: [mohamad-alaskari](https://github.com/mohamad-alaskari)

---

## üìú Lizenz

Dieses Projekt steht unter der MIT-Lizenz.
